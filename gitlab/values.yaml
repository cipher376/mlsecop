global:
  hosts:
    domain: mlsecops.local
    https: true # Note: If false, GitLab will use http:// internal links
  
  minio:
    enabled: false

  ingress:
    class: cilium 
    configureCertmanager: false # You are managing cert-manager separately
    tls:
      enabled: true
      secretName: gitlab-tls-cert # <--- This satisfies the requirement

  # ── EXTERNAL DATABASE ──────────────────────────────────────────────
  psql:
    # 'install: false' does NOT go here; it goes at the root level
    host: gitlab-db-postgresql.ml-build.svc.cluster.local
    port: 5432
    username: gitlab      # Ensure this matches the 'ALTER ROLE' name
    database: gitlabhq_production
    password:
      secret: gitlab-db-postgresql-secret
      key: password

  # ── EXTERNAL REDIS ─────────────────────────────────────────────────
  redis:
    host: gitlab-redis-master.ml-build.svc.cluster.local
    auth:
      enabled: true
      secret: gitlab-redis-secret
      key: redis-password

  # ── MONITORING ─────────────────────────────────────────────────────
  monitoring:
    prometheus:
      install: false
      host: prometheus-operated.ml-monitoring.svc.cluster.local
      port: 9090

  # ── CONSOLIDATED OBJECT STORAGE (SeaweedFS) ────────────────────────
  appConfig:
    object_store:
      enabled: true
      connection:
        secret: gitlab-seaweedfs-db-secret
        key: connection
    
    # These settings tell GitLab which buckets to use in SeaweedFS
    lfs:
      enabled: true
      bucket: gitlab-lfs
    artifacts:
      enabled: true
      bucket: gitlab-artifacts
    uploads:
      enabled: true
      bucket: gitlab-uploads
    packages:
      enabled: true
      bucket: gitlab-packages
    externalDiffs:
      enabled: true
      bucket: gitlab-external-diffs
    terraformState:
      enabled: true
      bucket: gitlab-terraform-state
    dependencyProxy:
      enabled: true
      bucket: gitlab-dependency-proxy

# ── TOP-LEVEL SUBCHART DISABLES ───────────────────────────────────────
# This is where 'install: false' belongs
postgresql:
  install: false

redis:
  install: false

minio:
  install: false

prometheus:
  install: false

gitlab-runner:
  install: false

nginx-ingress:
  enabled: false

installCertmanager: false # Move it to the root level, not under a 'certmanager' block
# ── COMPONENT SPECIFIC OVERRIDES ──────────────────────────────────────
gitlab:
  webservice:
    replicaCount: 2
    resources:
      requests:
        ephemeral-storage: "2Gi"
      limits:
        ephemeral-storage: "4Gi"
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 4Gi
  sidekiq:
    replicaCount: 1
    resources:
      requests:
        ephemeral-storage: "2Gi"
      limits:
        ephemeral-storage: "4Gi"
  gitaly:
    persistence:
      size: 50Gi
  migrations: # Help migrations run successfully by giving them more resources
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 1000m
        memory: 4Gi
  
  # CRITICAL: Point the Registry to SeaweedFS as well
  registry:
    enabled: true
    storage:
      secret: gitlab-seaweedfs-db-secret
      key: connection