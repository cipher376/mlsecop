
# HTTPRoute for Vault API
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vault-api-route
  namespace: ml-security
spec:
  parentRefs:
  - name: cilium-ingress-gateway
    namespace: ml-infrastructure # Points to the central namespace
    sectionName: https # Using the general listener for simplicity
  hostnames:
  - "vault.mlsecops.local"
  rules:
  # Route all /v1/* requests to Vault API
  - matches:
    - path:
        type: PathPrefix
        value: /v1/
    backendRefs:
    - name: vault
      port: 8200
  # Route root requests
  - matches:
    - path:
        type: Exact
        value: /
    backendRefs:
    - name: vault
      port: 8200
  # Route health check endpoints
  - matches:
    - path:
        type: PathPrefix
        value: /sys/health
    backendRefs:
    - name: vault
      port: 8200
  # Route UI requests
  - matches:
    - path:
        type: PathPrefix
        value: /ui/
    backendRefs:
    - name: vault
      port: 8200
---
# HTTPRoute for Vault UI (alternative path)
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vault-ui-route
  namespace: ml-security
spec:
  parentRefs:
  - name: cilium-ingress-gateway
    namespace: ml-infrastructure # Points to the central namespace
    sectionName: https # Using the general listener for simplicity
  hostnames:
  - "vault-ui.mlsecops.local"
  rules:
  - backendRefs:
    - name: vault
      port: 8200
